{{define "outline_main"}}
<main id="clarity-main">
  <h1>{{.Outline.Name}}</h1>

  <div class="card">
    <div><strong>Outline</strong>: <code>{{.Outline.ID}}</code></div>
    <div><strong>Project</strong>: <code>{{.Outline.ProjectID}}</code></div>
  </div>

  <div class="card">
    <div><strong>Items</strong></div>

    {{if and (not .ReadOnly) .ActorID}}
      <form method="post" action="/outlines/{{.Outline.ID}}/items" style="margin: 12px 0;">
        <label for="title"><span class="dim">New item</span></label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <input id="title" name="title" placeholder="Title" style="flex: 1;">
          <button type="submit">Add</button>
        </div>
      </form>
    {{end}}

    {{if .UseOutlineComponent}}
      <div data-signals='{"outlineItems": {{printf "%q" .ItemsJSON}}, "outlineStatusLabels": {{printf "%q" .StatusLabelsJSON}}, "outlineAssignees": {{printf "%q" .AssigneesJSON}}, "outlineTags": {{printf "%q" .TagsJSON}}}'></div>
      <clarity-outline
        id="outline"
        data-outline-id="{{.Outline.ID}}"
        data-current-user="{{.ActorID}}"
        data-attr:data-status-labels="$outlineStatusLabels"
        data-attr:data-assignees="$outlineAssignees"
        data-attr:data-tags="$outlineTags"
        data-features='{"addButton":false,"comments":false,"worklog":false,"archive":false,"priority":false,"onHold":false,"due":false,"schedule":false,"assign":false,"tags":false,"dragAndDrop":false}'
        data-attr:data-items="$outlineItems"
      ></clarity-outline>
      <div id="outline-status" class="dim" style="margin-top: 10px;"></div>
      <noscript>
        <div class="dim">JavaScript is disabled; showing a basic list.</div>
      </noscript>
    {{else}}
      {{template "outline_native" .}}
    {{end}}
  </div>
</main>
{{end}}

{{define "outline_node"}}
<li data-node-id="{{.ID}}">
  <div
    class="outline-row {{if not .CanEdit}}outline-row--readonly{{end}}"
    tabindex="0"
    data-outline-row
    data-kb-item
    data-focus-id="{{.ID}}"
    data-id="{{.ID}}"
    data-status="{{.StatusID}}"
    data-end="{{if .IsEndState}}true{{else}}false{{end}}"
    data-can-edit="{{if .CanEdit}}true{{else}}false{{end}}"
    data-open-href="/items/{{.ID}}"
    title="{{.ID}}"
  >
    <span class="outline-status {{if .IsEndState}}outline-status--end{{else}}outline-status--open{{end}}">
      {{if .StatusLabel}}{{.StatusLabel}}{{else}}{{if .StatusID}}{{.StatusID}}{{else}}(none){{end}}{{end}}
    </span>
    <span class="outline-title">{{.Title}}</span>
    {{if .AssignedLabel}}<span class="outline-assignee dim">@{{.AssignedLabel}}</span>{{end}}
  </div>
  {{if .Children}}
    <ul class="outline-children">
      {{range .Children}}
        {{template "outline_node" .}}
      {{end}}
    </ul>
  {{end}}
</li>
{{end}}

{{define "outline_native"}}
<div
  id="outline-native"
  data-outline-id="{{.Outline.ID}}"
  data-toggle-open="{{.ToggleOpenTo}}"
  data-toggle-end="{{.ToggleEndTo}}"
  data-toggle-open-label="{{.ToggleOpenLbl}}"
  data-toggle-end-label="{{.ToggleEndLbl}}"
  data-status-options='{{.StatusOptionsJSON}}'
  data-actor-options='{{.ActorOptionsJSON}}'
>
  <div class="dim" style="margin: 8px 0;">
    Native outline: <code>j/k</code> move · <code>e</code> edit · <code>Space</code> status · <code>a</code> assign · <code>Alt+j/k</code> reorder · <code>Ctrl+h/l</code> indent/outdent
  </div>
  {{if .NativeNodes}}
    <ul class="outline-tree">
      {{range .NativeNodes}}
        {{template "outline_node" .}}
      {{end}}
    </ul>
  {{else}}
    <div>(none)</div>
  {{end}}
  <div id="outline-status" class="dim" style="margin-top: 10px;"></div>
</div>
{{end}}

{{define "outline.html"}}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Clarity Web – Outline</title>
  <link rel="stylesheet" href="/static/app.css">
</head>
<body>
  {{template "web_header" .}}
  {{template "outline_main" .}}
  {{template "web_scripts" .}}
</body>
</html>
{{end}}
