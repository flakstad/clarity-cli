{{define "item_main"}}
<main id="clarity-main">
  <h1>{{.Item.Title}}</h1>
  <p class="meta">
    <a href="/">Home</a> · <a href="/projects">Projects</a>
    · now={{.Now}}
    {{if .Workspace}} · workspace={{.Workspace}}{{end}}
  </p>

  <div class="card">
    <div><strong>Item</strong>: <code>{{.Item.ID}}</code> <span class="dim">({{.Item.StatusID}})</span></div>
    <div><strong>Outline</strong>: <code>{{.Item.OutlineID}}</code></div>
    <div><strong>Owner</strong>: <code>{{.Item.OwnerActorID}}</code></div>
    {{if .Item.AssignedActorID}}<div><strong>Assignee</strong>: <code>{{.Item.AssignedActorID}}</code></div>{{end}}
    {{if .Item.ParentID}}<div><strong>Parent</strong>: <code>{{.Item.ParentID}}</code></div>{{end}}
  </div>

  {{if .SuccessMessage}}
    <div class="card"><div><strong>OK</strong> — {{.SuccessMessage}}</div></div>
  {{end}}
  {{if .ErrorMessage}}
    <div class="card"><div><strong>Error</strong> — {{.ErrorMessage}}</div></div>
  {{end}}

  {{if and (not .ReadOnly) .ActorID .CanEdit}}
    <div class="card">
      <div><strong>Edit</strong></div>
      <form method="post" action="/items/{{.Item.ID}}/edit" style="margin-top: 12px;">
        <div style="margin-top: 8px;">
          <label for="title"><span class="dim">Title</span></label>
          <div><input id="title" name="title" value="{{.Item.Title}}" style="width: 100%; max-width: 100%;"></div>
        </div>
        <div style="margin-top: 8px;">
          <label for="status"><span class="dim">Status</span></label>
          <div>
            <select id="status" name="status">
              <option value="" {{if eq .Item.StatusID ""}}selected{{end}}>(none)</option>
              {{range .StatusDefs}}
                <option value="{{.ID}}" {{if eq $.Item.StatusID .ID}}selected{{end}}>{{if .Label}}{{.Label}}{{else}}{{.ID}}{{end}}</option>
              {{end}}
            </select>
          </div>
        </div>
        <div style="margin-top: 8px;">
          <label for="description"><span class="dim">Description (Markdown)</span></label>
          <div><textarea id="description" name="description" rows="10" style="width: 100%; max-width: 100%;">{{.Item.Description}}</textarea></div>
        </div>
        <div style="margin-top: 8px;"><button type="submit">Save</button></div>
      </form>
    </div>
  {{end}}

  <div class="card">
    <div><strong>Description</strong></div>
    {{if .Item.Description}}<pre>{{.Item.Description}}</pre>{{else}}<div>(none)</div>{{end}}
  </div>

  <div class="card">
    <div><strong>Comments</strong> ({{len .Comments}})</div>
    {{if and (not .ReadOnly) .ActorID}}
      <form id="comment-form" method="post" action="/items/{{.Item.ID}}/comments" style="margin-top: 12px;">
        {{if .ReplyTo}}
          <div class="dim">Replying to <code>{{.ReplyTo}}</code> — <a href="/items/{{.Item.ID}}#comment-form">cancel</a></div>
          <input type="hidden" name="replyTo" value="{{.ReplyTo}}">
        {{end}}
        <div><label for="body"><span class="dim">Add comment</span></label></div>
        <div><textarea id="body" name="body" rows="4" style="width: 100%; max-width: 100%;"></textarea></div>
        <div style="margin-top: 8px;"><button type="submit">Post</button></div>
      </form>
    {{end}}
    {{if .Comments}}
      <ul>
        {{range .Comments}}
          <li>
            <span class="dim">{{.CreatedAt.Format "2006-01-02 15:04:05Z07:00"}}</span>
            — <code>{{.AuthorID}}</code>
            {{if .ReplyToCommentID}} <span class="dim">(reply to <code>{{.ReplyToCommentID}}</code>)</span>{{end}}
            {{if and (not $.ReadOnly) $.ActorID}} <span class="dim">— <a href="/items/{{$.Item.ID}}?replyTo={{.ID}}#comment-form">reply</a></span>{{end}}
            <pre>{{.Body}}</pre>
          </li>
        {{end}}
      </ul>
    {{else}}
      <div>(none)</div>
    {{end}}
  </div>

  <div class="card">
    <div><strong>Worklog</strong> (private)</div>
    {{if and (not .ReadOnly) .ActorID}}
      <form id="worklog-form" method="post" action="/items/{{.Item.ID}}/worklog" style="margin-top: 12px;">
        <div><label for="worklog"><span class="dim">Add worklog entry (only visible to you)</span></label></div>
        <div><textarea id="worklog" name="body" rows="4" style="width: 100%; max-width: 100%;"></textarea></div>
        <div style="margin-top: 8px;"><button type="submit">Add</button></div>
      </form>
    {{end}}
    {{if .Worklog}}
      <ul>
        {{range .Worklog}}
          <li>
            <span class="dim">{{.CreatedAt.Format "2006-01-02 15:04:05Z07:00"}}</span>
            <pre>{{.Body}}</pre>
          </li>
        {{end}}
      </ul>
    {{else}}
      <div class="dim">(none)</div>
    {{end}}
  </div>
</main>
{{end}}

{{define "item.html"}}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Clarity Web – Item</title>
  <link rel="stylesheet" href="/static/app.css">
</head>
<body>
  {{template "item_main" .}}
  {{template "web_scripts" .}}
</body>
</html>
{{end}}
